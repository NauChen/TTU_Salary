var dataset_parkingSpaceApp = [
    {
        'id': '1',
        'createDate': '2024-07-01',
        'company': '超級棒股份有限公司',
        'uniformNum': '12345678',
        'name': '孫小美',
        'phone': '02-81234567',
        'ext': '1234',
        'idNumber': 'A1234567890',
        'email': 'sunxiaomei@example.com',
        'jobTitle': '財務經理',
        'carType': '汽車',
        'licensePlateNum': '8866-AB',
        'wantStartDate': '2024-06-30',
        'applicationFile': 'PS202406301',
        'status': '不通過',
        'adminNote': '兩個車位',
        'assignId': '30',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B1-01',
        'startDate': '2024-07-01',
    },
    {
        'id': '2',
        'createDate': '2024-06-30',
        'company': '超級棒股份有限公司',
        'uniformNum': '23456789',
        'name': '孫中美',
        'phone': '0912-345678',
        'ext': '5678',
        'idNumber': 'B0987654321',
        'email': 'sunzhongmei@example.com',
        'jobTitle': '業務專員',
        'carType': '機車',
        'licensePlateNum': '3GR-123',
        'wantStartDate': '2024-07-30',
        'applicationFile': 'PS202407302',
        'status': '待補件',
        'adminNote': '老是拖款',
        'assignId': '31',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B3-01',
        'startDate': '2024-08-01',
    },
    {
        'id': '3',
        'createDate': '2024-07-15',
        'company': '最佳有限公司',
        'uniformNum': '34567890',
        'name': '李大仁',
        'phone': '02-83456789',
        'ext': '2345',
        'idNumber': 'C2345678901',
        'email': 'lidanren@example.com',
        'jobTitle': '技術主管',
        'carType': '汽車',
        'licensePlateNum': '1234-CD',
        'wantStartDate': '2024-08-30',
        'applicationFile': 'PS202408303',
        'status': '待審核',
        'adminNote': '要主動提醒',
        'assignId': '32',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B2-05',
        'startDate': '2024-09-01',
    },
    {
        'id': '4',
        'createDate': '2024-07-10',
        'company': '快樂企業股份有限公司',
        'uniformNum': '45678901',
        'name': '王小明',
        'phone': '0913-456789',
        'ext': '3456',
        'idNumber': 'D3456789012',
        'email': 'wangxiaoming@example.com',
        'jobTitle': '客服經理',
        'carType': '機車',
        'licensePlateNum': '5XY-678',
        'wantStartDate': '2024-07-10',
        'applicationFile': 'PS202407104',
        'status': '待補件',
        'adminNote': '',
        'assignId': '33',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B4-02',
        'startDate': '2024-07-11',
    },
    {
        'id': '5',
        'createDate': '2024-07-20',
        'company': '幸福股份有限公司',
        'uniformNum': '56789012',
        'name': '陳美麗',
        'phone': '02-87654321',
        'ext': '4567',
        'idNumber': 'E4567890123',
        'email': 'chenmeili@example.com',
        'jobTitle': '行銷主管',
        'carType': '汽車',
        'licensePlateNum': '5678-EF',
        'wantStartDate': '2024-07-20',
        'applicationFile': 'PS202407205',
        'status': '待審核',
        'adminNote': '',
        'assignId': '',
        'building': '',
        'parkingSpaceNum': '',
        'startDate': '',
    },
    {
        'id': '6',
        'createDate': '2024-06-25',
        'company': '優秀有限公司',
        'uniformNum': '67890123',
        'name': '張偉',
        'phone': '0914-567890',
        'ext': '5678',
        'idNumber': 'F5678901234',
        'email': 'zhangwei@example.com',
        'jobTitle': '產品經理',
        'carType': '機車',
        'licensePlateNum': '6AB-456',
        'wantStartDate': '2024-07-14',
        'applicationFile': 'PS202407146',
        'status': '通過',
        'adminNote': '要求很多所以收比較貴',
        'assignId': '35',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B6-03',
        'startDate': '2024-07-14',
    },
    {
        'id': '7',
        'createDate': '2024-06-20',
        'company': '卓越股份有限公司',
        'uniformNum': '78901234',
        'name': '黃小虎',
        'phone': '02-76543210',
        'ext': '6789',
        'idNumber': 'G6789012345',
        'email': 'huangxiaohu@example.com',
        'jobTitle': '行政助理',
        'carType': '汽車',
        'licensePlateNum': '7890-GH',
        'wantStartDate': '2024-07-12',
        'applicationFile': 'PS202407127',
        'status': '不通過',
        'adminNote': '優良公司',
        'assignId': '36',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B7-04',
        'startDate': '2024-07-12',
    },
    {
        'id': '8',
        'createDate': '2024-07-05',
        'company': '智慧科技有限公司',
        'uniformNum': '89012345',
        'name': '吳小華',
        'phone': '02-78901234',
        'ext': '7890',
        'idNumber': 'H7890123456',
        'email': 'wuxiaohua@example.com',
        'jobTitle': '研發工程師',
        'carType': '汽車',
        'licensePlateNum': '8901-IJ',
        'wantStartDate': '2024-07-17',
        'applicationFile': 'PS202407178',
        'status': '通過',
        'adminNote': '會亂停車',
        'assignId': '37',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B8-02',
        'startDate': '2024-07-17',
    },
    {
        'id': '9',
        'createDate': '2024-06-28',
        'company': '永續發展股份有限公司',
        'uniformNum': '90123456',
        'name': '葉大勇',
        'phone': '0915-678901',
        'ext': '8901',
        'idNumber': 'I8901234567',
        'email': 'yedayong@example.com',
        'jobTitle': '人力資源經理',
        'carType': '機車',
        'licensePlateNum': '9JK-789',
        'wantStartDate': '2024-07-10',
        'applicationFile': 'PS202407109',
        'status': '不通過',
        'adminNote': '',
        'assignId': '38',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B9-03',
        'startDate': '2024-07-15',
    },
    {
        'id': '10',
        'createDate': '2024-07-12',
        'company': '環保綠能有限公司',
        'uniformNum': '01234567',
        'name': '趙明志',
        'phone': '02-89012345',
        'ext': '9012',
        'idNumber': 'J9012345678',
        'email': 'zhaomingzhi@example.com',
        'jobTitle': '客戶經理',
        'carType': '汽車',
        'licensePlateNum': '0123-KL',
        'wantStartDate': '2024-07-26',
        'applicationFile': 'PS2024072610',
        'status': '通過',
        'adminNote': '',
        'assignId': '39',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B10-01',
        'startDate': '2024-07-26',
    },
    {
        'id': '11',
        'createDate': '2024-07-01',
        'company': '創意科技有限公司',
        'uniformNum': '12345679',
        'name': '林小偉',
        'phone': '0916-789012',
        'ext': '1234',
        'idNumber': 'K0123456789',
        'email': 'linxiaowei@example.com',
        'jobTitle': '市場專員',
        'carType': '機車',
        'licensePlateNum': '1LM-234',
        'wantStartDate': '2024-07-24',
        'applicationFile': 'PS2024072411',
        'status': '待審核',
        'adminNote': '共用車位',
        'assignId': '40',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B11-02',
        'startDate': '2024-07-24',
    },
    {
        'id': '12',
        'createDate': '2024-07-03',
        'company': '健康醫療有限公司',
        'uniformNum': '23456780',
        'name': '劉小玲',
        'phone': '02-90123456',
        'ext': '2345',
        'idNumber': 'L1234567890',
        'email': 'liuxiaoling@example.com',
        'jobTitle': '財務分析師',
        'carType': '汽車',
        'licensePlateNum': '3456-MN',
        'wantStartDate': '2024-07-17',
        'applicationFile': 'PS2024071712',
        'status': '通過',
        'adminNote': '',
        'assignId': '41',
        'building': '新德惠大樓',
        'parkingSpaceNum': 'B12-01',
        'startDate': '2024-07-17',
    }
];


// var selectOption = [
//     { 'optigroup': '新德惠大樓', 'option': 'B1-01' },
//     { 'optigroup': '新德惠大樓', 'option': 'B1-05' },
//     { 'optigroup': '新德惠大樓', 'option': 'B2-05' },
//     { 'optigroup': '新德惠大樓', 'option': 'B2-08' },
//     { 'optigroup': '新德惠大樓', 'option': 'B3-01' },
//     { 'optigroup': '新德惠大樓', 'option': 'B3-10' },
//     { 'optigroup': '新德惠大樓', 'option': 'B4-02' },
//     { 'optigroup': '新德惠大樓', 'option': 'B6-03' },
//     { 'optigroup': '新德惠大樓', 'option': 'B7-04' },
//     { 'optigroup': '新德惠大樓', 'option': 'B8-02' },
//     { 'optigroup': '新德惠大樓', 'option': 'B9-03' },
//     { 'optigroup': '青創大樓', 'option': 'B10-01' },
//     { 'optigroup': '青創大樓', 'option': 'B11-02' },
//     { 'optigroup': '青創大樓', 'option': 'B12-01' },
// ];


$(function () {

    $('#parkingSpaceApplicationList').DataTable({
        ...commonSettingsTable,
        "data": dataset_parkingSpaceApp,
        "columns": [
            { data: 'createDate', title: "申請日期" }, // 0
            { data: 'company', title: "承租人企業", }, // 1
            { data: 'carType', title: "車位類型", }, // 2
            { data: 'licensePlateNum', title: "車牌號碼", }, // 3
            { data: 'name', title: "申請人", }, // 4
            { data: 'wantStartDate', title: "預計起租日", }, // 5
            { data: 'status', title: "審核進度", }, // 6
            {
                data: 'id', title: "檢閱", // 7
                render: function (data, type, row) {
                    const status = row.status;
                    if (status == "通過" || status == "不通過") {
                        return '<button type="button" class="btn btn-outline-primary rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#parkingSpaceDetailModel" data-id="' + data + '"><i class="fa-solid fa-paperclip"></i></button>'
                    } else {
                        return '<button type="button" class="btn btn-primary rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#parkingSpaceDetailModel" data-id="' + data + '"><i class="fa-solid fa-paperclip"></i></button>'
                    }
                }, className: 'text-center text-nowrap'
            },
        ],
        "columnDefs": [
            {
                targets: [1],
                responsivePriority: 1,
            },
            {
                targets: [2],
                responsivePriority: 2,
            },
            {
                targets: [4],
                responsivePriority: 3,
            },

            { searchable: false, orderable: false, targets: [7] },
            { className: "text-center", targets: [0, 2, 3, 4, 5] },
            { className: "text-nowrap", targets: [0, 2, 3, 4, 5] },
        ],
        createdRow: function (row, data, dataIndex) {
            $('td:eq(7)', row).css('min-width', '70px');
            [0, 5].forEach(function (colIdx) {
                $('td:eq(' + colIdx + ')', row).css('min-width', '130px').css('font-size', '.9em');
            });
        }
    });

    $('#parkingSpaceDetailModel').on('show.bs.modal', function (event) {
        let button = $(event.relatedTarget);
        // console.log('Event relatedTarget:', button);
        let psId = String(button.data('id'));
        console.log('psId:', psId); // 確認 psId 是否正確獲取

        // 解除先前綁定的點擊事件
        $('#psApp_updateBtn').off('click');
        $('#danger_parkingSpaceApp').text('');

        CustomInputHandlers.destroy();
        $('#psApp_name, #psApp_jobTitle, #psApp_adminNote').removeClass('changeInput_items');
        $('#psApp_ext').removeClass('changeUniformNum_items');
        $('#psApp_phoneNum').removeClass('changePhone_items');
        $('#psApp_email').removeClass('changeEmail_items');
        $('#psApp_idNumber').removeClass('changeInputUpperNumber_items');
        $('#psApp_carType').removeClass('changeRadioCar_items');
        $('#psApp_licensePlateNum').removeClass('changeInputUpperNumberHyphen_items');
        $('#psApp_wantStartDate').removeClass('changeDate_items');
        $('#psApp_name, #psApp_jobTitle, #psApp_adminNote, #psApp_ext, #psApp_phoneNum, #psApp_email, #psApp_idNumber, #psApp_carType, #psApp_licensePlateNum, #psApp_wantStartDate').addClass('readOnly');

        let parkingSpaceData = dataset_parkingSpaceApp.find(perkingSpace => perkingSpace.id === psId);
        // 代入資料
        if (parkingSpaceData) {
            $('#psApp_companyName').text(parkingSpaceData.company);
            $('#psApp_uniformNum').text(parkingSpaceData.uniformNum);
            $('#psApp_createDate').text(parkingSpaceData.createDate);

            $('#psApp_name').text(parkingSpaceData.name);
            $('#psApp_phoneNum').text(parkingSpaceData.phone);
            $('#psApp_ext').text(parkingSpaceData.ext);

            $('#psApp_idNumber').text(parkingSpaceData.idNumber);
            $('#psApp_email').text(parkingSpaceData.email);
            $('#psApp_jobTitle').text(parkingSpaceData.jobTitle);

            $('#psApp_carType').text(parkingSpaceData.carType);
            $('#psApp_licensePlateNum').text(parkingSpaceData.licensePlateNum);
            $('#psApp_wantStartDate').text(parkingSpaceData.wantStartDate);

            $('#psApp_building').text(parkingSpaceData.building);
            $('#psApp_parkingSpaceNum').text(parkingSpaceData.parkingSpaceNum);
            $('#psApp_startDate').text(parkingSpaceData.startDate);

            $('#psApp_adminNote').text(parkingSpaceData.adminNote);

            $('#psApp_status').val(parkingSpaceData.status);






        } else {
            console.error('parkingSpaceData data not found for id:', psId);
        };

        if (!parkingSpaceData.assignId) {
            $('#psApp_status').hide();
            $('#psApp_supplementaryFilesBox').hide();
            $('#psApp_updateBtn').hide();
            $('#psApp_statusText').show().text(parkingSpaceData.status);
            $('#danger_parkingSpaceApp').text('請至「收款與收據」將車位配置好，才可以開始審核歐！');


        } else {
            if (parkingSpaceData.status === "通過" || parkingSpaceData.status === "不通過") {
                $('#psApp_supplementaryFilesBox').hide();
                $('#psApp_status').hide();
                $('#psApp_statusText').show().text(parkingSpaceData.status);

            } else {
                $('#psApp_name, #psApp_jobTitle, #psApp_adminNote').addClass('changeInput_items');
                $('#psApp_ext').addClass('changeUniformNum_items');
                $('#psApp_phoneNum').addClass('changePhone_items');
                $('#psApp_email').addClass('changeEmail_items');
                $('#psApp_idNumber').addClass('changeInputUpperNumber_items');
                $('#psApp_carType').addClass('changeRadioCar_items');
                $('#psApp_licensePlateNum').addClass('changeInputUpperNumberHyphen_items');
                $('#psApp_wantStartDate').addClass('changeDate_items');
                $('#psApp_name, #psApp_jobTitle, #psApp_adminNote, #psApp_ext, #psApp_phoneNum, #psApp_email, #psApp_idNumber, #psApp_carType, #psApp_licensePlateNum, #psApp_wantStartDate').removeClass('readOnly');
                CustomInputHandlers.init();
                $('#psApp_updateBtn').show();
                $('#psApp_supplementaryFilesBox').show();
                $('#psApp_status').show();
                $('#psApp_statusText').hide();
            }

        }

        $('#psApp_updateBtn').on('click', function () {


            // console.log('psId 2 :', psId); // 確認 psId 是否正確獲取
            // 清除上次的資料
            updatedData = {};
            // 獲取所有欄位的目前值
            updatedData.id = psId;
            updatedData.companyName = $('#psApp_companyName').text();
            updatedData.uniformNum = $('#psApp_uniformNum').text();
            updatedData.createDate = $('#psApp_createDate').text();
            updatedData.name = $('#psApp_name').text();
            updatedData.phoneNum = $('#psApp_phoneNum').text();
            updatedData.ext = $('#psApp_ext').text();
            updatedData.idNumber = $('#psApp_idNumber').text();
            updatedData.email = $('#psApp_email').text();
            updatedData.jobTitle = $('#psApp_jobTitle').text();
            updatedData.carType = $('#psApp_carType').text();
            updatedData.licensePlateNum = $('#psApp_licensePlateNum').text();
            updatedData.wantStartDate = $('#psApp_wantStartDate').text();

            updatedData.assignId = parkingSpaceData.assignId;

            updatedData.adminNote = $('#psApp_adminNote').text();
            updatedData.status = $('#psApp_status').val();

            console.log(updatedData);



            // 將更新的資料送到後端
            // $.ajax({
            //     url: '您的後端URL', // 替換成您的後端接收更新請求的URL
            //     type: 'POST', // 或者 'PUT'，根據您的後端接口設計來決定
            //     contentType: 'application/json',
            //     data: JSON.stringify(updatedData),
            //     success: function (response) {
            //         // 處理成功回應
            //         console.log('更新成功:', response);
            //         // 根據需要執行其他操作，例如顯示成功訊息
            //     },
            //     error: function (xhr, status, error) {
            //         // 處理錯誤情況
            //         console.error('更新失敗:', error);
            //         // 根據需要顯示錯誤訊息或執行其他操作
            //     }
            // });
        });



    });


});