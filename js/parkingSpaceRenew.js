var dataset_myParkingSpaceHistory = [
    {
        'paymentDate': '2024-05-28',
        'carType': '汽車',
        'parkingSpaceNum': 'B4-30',
        'name': '陳凱富',
        'licensePlateNum': '0869-RE',
        'endDate': '2024-06-18',
        'remark': '-',
        'id': '1',
        'jobTitle': '經理',
        'ext': '123',
        'phone': '02-86710869',
        'email': 'chenkaifu@example.com'
    },
    {
        'paymentDate': '2024-05-17',
        'carType': '機車',
        'parkingSpaceNum': 'B5-1',
        'name': '陳昭嫺',
        'licensePlateNum': 'X-8470',
        'endDate': '2024-06-08',
        'remark': '-',
        'id': '2',
        'jobTitle': '工程師',
        'ext': '456',
        'phone': '0912-345678',
        'email': 'chenzhaoxian@example.com'
    },
    {
        'paymentDate': '2024-04-18',
        'carType': '汽車',
        'parkingSpaceNum': 'B6-12',
        'name': '林雅惠',
        'licensePlateNum': '4823-JF',
        'endDate': '2024-05-18',
        'remark': '-',
        'id': '3',
        'jobTitle': '分析師',
        'ext': '789',
        'phone': '02-86714823',
        'email': 'linyahuei@example.com'
    },
    {
        'paymentDate': '2024-05-15',
        'carType': '機車',
        'parkingSpaceNum': 'B7-5',
        'name': '張文成',
        'licensePlateNum': '2-9685',
        'endDate': '2024-06-17',
        'remark': '-',
        'id': '4',
        'jobTitle': '主任',
        'ext': '112',
        'phone': '0912-346789',
        'email': 'zhangwencheng@example.com'
    },
    {
        'paymentDate': '2024-04-30',
        'carType': '汽車',
        'parkingSpaceNum': 'B8-21',
        'name': '許美玲',
        'licensePlateNum': '7219-LK',
        'endDate': '2024-05-30',
        'remark': '-',
        'id': '5',
        'jobTitle': '助理',
        'ext': '-',
        'phone': '02-86717219',
        'email': 'hsiumeiling@example.com'
    },
    {
        'paymentDate': '2024-06-02',
        'carType': '機車',
        'parkingSpaceNum': 'B9-8',
        'name': '黃佩樺',
        'licensePlateNum': '7-Y245',
        'endDate': '2024-07-02',
        'remark': '-',
        'id': '6',
        'jobTitle': '專員',
        'ext': '321',
        'phone': '0912-347890',
        'email': 'huangpeihua@example.com'
    },
    {
        'paymentDate': '2024-06-05',
        'carType': '汽車',
        'parkingSpaceNum': 'B10-18',
        'name': '劉建宏',
        'licensePlateNum': '5390-ZP',
        'endDate': '2024-07-05',
        'remark': '-',
        'id': '7',
        'jobTitle': '經理',
        'ext': '654',
        'phone': '02-86715390',
        'email': 'liujianhong@example.com'
    },
    {
        'paymentDate': '2024-06-01',
        'carType': '機車',
        'parkingSpaceNum': 'B11-3',
        'name': '吳明憲',
        'licensePlateNum': '9-5012',
        'endDate': '2024-07-01',
        'remark': '-',
        'id': '8',
        'jobTitle': '主任',
        'ext': '987',
        'phone': '0912-348901',
        'email': 'wumingxian@example.com'
    },
    {
        'paymentDate': '2024-05-26',
        'carType': '汽車',
        'parkingSpaceNum': 'B12-9',
        'name': '蔡淑芬',
        'licensePlateNum': '4825-NX',
        'endDate': '2024-06-23',
        'remark': '-',
        'id': '9',
        'jobTitle': '分析師',
        'ext': '234',
        'phone': '02-86714825',
        'email': 'caishufen@example.com'
    },
    {
        'paymentDate': '2024-05-15',
        'carType': '機車',
        'parkingSpaceNum': 'B13-6',
        'name': '陳芳儀',
        'licensePlateNum': '6-X084',
        'endDate': '2024-06-26',
        'remark': '-',
        'id': '10',
        'jobTitle': '工程師',
        'ext': '567',
        'phone': '0912-349012',
        'email': 'chenfangyi@example.com'
    },
    {
        'paymentDate': '2024-05-09',
        'carType': '汽車',
        'parkingSpaceNum': 'B14-28',
        'name': '葉文祥',
        'licensePlateNum': '1265-DK',
        'endDate': '2024-06-26',
        'remark': '-',
        'id': '11',
        'jobTitle': '助理',
        'ext': '890',
        'phone': '02-86711265',
        'email': 'yewenxiang@example.com'
    },
    {
        'paymentDate': '2024-05-18',
        'carType': '機車',
        'parkingSpaceNum': 'B15-10',
        'name': '劉惠珍',
        'licensePlateNum': '3-L769',
        'endDate': '2024-06-18',
        'remark': '-',
        'id': '12',
        'jobTitle': '專員',
        'ext': '123',
        'phone': '0912-341234',
        'email': 'liuhuizhen@example.com'
    },
    {
        'paymentDate': '2025-01-25',
        'carType': '汽車',
        'parkingSpaceNum': 'B16-15',
        'name': '林秋美',
        'licensePlateNum': '9274-BH',
        'endDate': '2025-02-25',
        'remark': '-',
        'id': '13',
        'jobTitle': '經理',
        'ext': '456',
        'phone': '02-86719274',
        'email': 'linqiumei@example.com'
    },
    {
        'paymentDate': '2025-02-14',
        'carType': '機車',
        'parkingSpaceNum': 'B17-2',
        'name': '張雅婷',
        'licensePlateNum': '7-V821',
        'endDate': '2025-03-14',
        'remark': '-',
        'id': '14',
        'jobTitle': '主任',
        'ext': '789',
        'phone': '0912-342345',
        'email': 'zhangyating@example.com'
    },
    {
        'paymentDate': '2025-03-08',
        'carType': '汽車',
        'parkingSpaceNum': 'B18-25',
        'name': '郭大偉',
        'licensePlateNum': '6841-MG',
        'endDate': '2025-04-08',
        'remark': '-',
        'id': '15',
        'jobTitle': '工程師',
        'ext': '112',
        'phone': '02-86716841',
        'email': 'guodawei@example.com'
    },
    {
        'paymentDate': '2025-04-22',
        'carType': '機車',
        'parkingSpaceNum': 'B19-4',
        'name': '陳志明',
        'licensePlateNum': '1-Q525',
        'endDate': '2025-05-22',
        'remark': '-',
        'id': '16',
        'jobTitle': '助理',
        'ext': '345',
        'phone': '0912-343456',
        'email': 'chenzhiming@example.com'
    },
    {
        'paymentDate': '2024-05-10',
        'carType': '汽車',
        'parkingSpaceNum': 'B20-13',
        'name': '王美玲',
        'licensePlateNum': '9406-CP',
        'endDate': '2024-06-21',
        'remark': '-',
        'id': '17',
        'jobTitle': '專員',
        'ext': '678',
        'phone': '02-86719406',
        'email': 'wangmeiling@example.com'
    },
    {
        'paymentDate': '2025-06-29',
        'carType': '機車',
        'parkingSpaceNum': 'B21-7',
        'name': '林志豪',
        'licensePlateNum': '8-N012',
        'endDate': '2025-07-29',
        'remark': '-',
        'id': '18',
        'jobTitle': '經理',
        'ext': '901',
        'phone': '0912-344567',
        'email': 'linzhihao@example.com'
    },
    {
        'paymentDate': '2025-07-15',
        'carType': '汽車',
        'parkingSpaceNum': 'B22-20',
        'name': '楊惠君',
        'licensePlateNum': '1782-QR',
        'endDate': '2025-08-15',
        'remark': '-',
        'id': '19',
        'jobTitle': '主任',
        'ext': '234',
        'phone': '02-86711782',
        'email': 'yanghuijun@example.com'
    },
    {
        'paymentDate': '2024-05-09',
        'carType': '機車',
        'parkingSpaceNum': 'B23-12',
        'name': '陳建宏',
        'licensePlateNum': '5-H953',
        'endDate': '2024-06-09',
        'remark': '-',
        'id': '20',
        'jobTitle': '助理',
        'ext': '567',
        'phone': '0912-345678',
        'email': 'chenjianhong@example.com'
    }
];


$(function () {

    // 抓取要代進的資料
    let sessionData = session_userData;
    // 同步session跟燈箱
    $('#parkingSpaceCompany_td').text(sessionData.company);


    const urlParams = new URLSearchParams(window.location.search);
    const parkingSpaceId = String(urlParams.get('id'));

    // 確保 parkingSpaceId 存在
    if (parkingSpaceId) {
        // console.log('ParkingSpace ID:', parkingSpaceId);
        let parkingSpaceData = dataset_myParkingSpaceHistory.find(parkingSpace => parkingSpace.id === parkingSpaceId);
        if (parkingSpaceData) {
            // 取得地下樓層放入預覽燈箱
            $('#basementLevel_td').text(extractSubstringBetween(parkingSpaceData.parkingSpaceNum, 'B', '-'));
            $('#parkingSpaceNum_td').text(parkingSpaceData.parkingSpaceNum);

            // 依據原車位顯示上傳行照的按鈕
            if (parkingSpaceData.carType === '汽車') {
                $('#btn_motoBox').hide();
            } else if (parkingSpaceData.carType === '機車') {
                $('#btn_carBox').hide();
            } else {
                $('#btn_carBox').hide();
                $('#btn_motoBox').hide();
            }

            // 確保起租日期不可小於 當日+5天 或是 截止日期當日(使用最晚的日期來設定)
            setLaterMinDate('parkingSpaceStartDate', 5, parkingSpaceData.endDate, 0);


        } else {
            console.error('ParkingSpace data not found for id:', parkingSpaceId);
        }
    } else {
        console.error('ParkingSpace ID not found in URL');
    }


    // 同步輸入框跟預覽td
    syncInputValue('parkingSpaceName', 'parkingSpaceName_td');
    syncInputValue('parkingSpaceJobTitle', 'parkingSpaceJobTitle_td');
    syncInputValue('parkingSpaceExt', 'parkingSpaceExt_td');

    syncInputValue('licensePlateNum', 'licensePlateNum_td');
    syncInputValue('parkingSpaceStartDate', 'parkingSpaceStartDate_td');

    syncInputValue('parkingSpaceIDNum', 'parkingSpaceIDNum_td');
    syncInputValue('parkingSpacePhone', 'parkingSpacePhone_td');
    syncInputValue('parkingSpaceEmail', 'parkingSpaceEmail_td');

    // 若必填欄位更改，及時更新錯誤訊息
    $('.thisRequired').on('input change', function () {
        checkThisRequiredElements.call(this);
    });

    // 點擊預覽燈箱
    $('#confirm_parkingSpaceRenew').click(function (event) {
        // 先檢查必填項
        if (!checkRequiredElements()) {
            swalToastWarning('請將必填欄位填上正確資料唷！', 'top');
            return; // 如果必填項有未填寫的，直接返回，不再繼續
        }
        // 最後檢查 danger_ 開頭元素的文字內容
        if (checkDangerElements()) {
            // 如果返回 true，開啟燈箱
            $('#parkingSpaceRenew_pdf').modal('show');
        } else {
            // 如果返回 false，顯示警告訊息
            swalToastWarning('請上傳行照圖檔，並裁剪成指定大小唷！', 'top');
        }
        // $('#parkingSpaceRenew_pdf').modal('show');
    });

    // 點擊 submitBtn 按鈕時
    $('#printAndSubmit').click(function (event) {
        $('#formParkingSpaceRenew').submit(); // 提交表單
        console.log('表單資料已送出');
    });

});