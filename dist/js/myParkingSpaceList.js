$(function(){console.log("dataset_myParkingSpaceHistory:",dataset_myParkingSpaceHistory),$("#myParkingSpaceList").DataTable({...commonSettingsProvision,layout:{topStart:function(){var t=document.createElement("div");return t.innerHTML='<h6 class="fw-bold"><i class="fa-solid fa-circle-exclamation mx-1"></i>若要續用，請於車位到期的5~45天之前提出申請。</h6>',t}},data:dataset_myParkingSpaceHistory,columns:[{data:"carType",title:"類型",render:function(t){let a="";switch(t){case"汽車":a='<i class="fa-solid fa-car-side" title="汽車"></i>';break;case"機車":a='<i class="fa-solid fa-motorcycle" title="機車"></i>';break;case"申請書":a='<i class="fa-regular fa-clipboard" title="申請書"></i>';break;default:a='<i class="fa-solid fa-question"></i>'}return a}},{data:"building",title:"所在位置"},{data:"parkingSpaceNum",title:"車位號碼"},{data:"licensePlateNum",title:"車牌號碼"},{data:"name",title:"登記<br class='d-none d-lg-block'>使用人"},{data:"endDate",title:"申請日期/<br class='d-none d-lg-block'>車位到期日"},{data:"remark",title:"備註"},{data:"id",title:"操作",render:function(t,a,e){return"申請書"==e.carType&&"申請中"==e.remark?'<button type="button" class="btn btn-outline-danger rounded-circle btn-sm deleteThisApply" title="取消申請" data-id="'+t+'"><i class="fa-solid fa-xmark"></i></button>':e.diffDays&&e.diffDays<=45?'<a class="btn btn-outline-primary rounded-circle btn-sm oneWord renew-btn" href="./parkingSpaceRenew.html?id='+t+'" title="立即續約" data-id='+t+'><i class="fa-solid fa-repeat"></i></a>':""}},{data:"diffDays",visible:!1},{data:"carType",visible:!1}],order:[[8,"desc"],[5,"desc"]],columnDefs:[{targets:[1],responsivePriority:1},{targets:[2],responsivePriority:2},{targets:[3],responsivePriority:3},{searchable:!1,orderable:!1,targets:[0,7,8]},{orderable:!1,targets:[9]},{className:"text-lg-center",targets:[0,2,3,4,5,7]}],createdRow:function(a,t,e){t.diffDays&&(""==t.remark||"申請中"==t.remark)||$("td",a).css("color","#999"),$("td:eq(5)",a).css("font-size",".95em").css("width","110px"),$("td:eq(6)",a).css("font-size",".95em").css("min-width","250px"),[0,1,2,3,5,6].forEach(function(t){$("td:eq("+t+")",a).addClass("text-nowrap")}),[0,7,8].forEach(function(t){$("td:eq("+t+")",a).css("max-width","70px")})}})}),$(function(){$(document).on("click",".renew-btn",function(t){t.preventDefault();t=$(this).data("id");let a="./parkingSpaceRenew.html?id="+t;swalConfirmNoToastSandId("登記使用人是否變更呢?","是","否",function(){window.location.href=a},"已將收款帳戶資訊發至貴司的主要聯絡信箱。<br><br>點擊上方「填寫轉帳證明」：<br>可上傳轉帳憑證，或是閱覽大同大學帳戶資訊。","top",t)})}),$(function(){$("#myParkingSpaceList").on("click",".deleteThisApply",function(){let t=$(this).data("id");swalConfirm("確定要取消此筆申請嗎?","是，請取消申請","不，沒有要取消",function(){$.ajax({url:removePSapplyUrl,method:"POST",data:{id:t},success:function(t){swalToastSuccess(t.message,"top"),setTimeout(function(){location.reload()},2300)},error:function(t,a,e){console.error("取消失敗:",e),swalToastWarning("刪除車位申請時發生錯誤。","top")}})})})});