var dataset_myCultivationRoom=[{id:"1",startDate:"2023-07-01",endDate:"2024-06-31",building:"新德惠大樓",room:"101",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"",paymentDate:"2024-05-20",remark:"已到期未續約"},{id:"2",startDate:"2023-07-14",endDate:"2024-07-15",building:"綜合大樓",room:"104",thisTimeDeadline:"2024-04-15",nextTimeDeadline:"2024-07-15",paymentDate:"",remark:""},{id:"3",startDate:"2024-06-01",endDate:"2025-05-31",building:"挺生大樓",room:"105",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"",paymentDate:"",remark:""},{id:"4",startDate:"2024-06-01",endDate:"2026-05-31",building:"實驗大樓",room:"106",thisTimeDeadline:"2025-05-01",nextTimeDeadline:"2026-05-01",paymentDate:"2024-11-28",remark:""},{id:"5",startDate:"2024-06-01",endDate:"2025-05-31",building:"實驗大樓",room:"201",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"",paymentDate:"",remark:""},{id:"6",startDate:"2024-06-01",endDate:"2025-05-31",building:"北設工大樓",room:"202",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"2024-12-01",paymentDate:"2024-11-27",remark:""},{id:"7",startDate:"2024-06-01",endDate:"2025-05-31",building:"尚志大樓",room:"A4-102",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"2024-07-01",paymentDate:"",remark:"下階段款項已逾期，如若已付款請提供匯款資訊。"},{id:"8",startDate:"2024-06-01",endDate:"2025-05-31",building:"新德惠大樓",room:"A4-103",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"",paymentDate:"",remark:"本階段為最末段，請準備續約。"},{id:"9",startDate:"2024-06-01",endDate:"2025-05-31",building:"綜合大樓",room:"714",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"2024-07-01",paymentDate:"2024-11-28",remark:"下階段已付款"},{id:"10",startDate:"2024-06-01",endDate:"2025-05-31",building:"挺生大樓",room:"809",thisTimeDeadline:"2024-05-22",nextTimeDeadline:"",paymentDate:"",remark:"本階段為最末段，請準備續約。"}];$(function(){let r=new Date;dataset_myCultivationRoom.forEach(e=>{var t=new Date(e.endDate).getTime()-r.getTime(),t=(e.endDiffDays=Math.ceil(t/864e5),new Date(e.thisTimeDeadline)),a=new Date(e.nextTimeDeadline);isNaN(a.getTime())?(t=t.getTime()-r.getTime(),e.deadLineDiffDays=Math.ceil(t/864e5)):(t=a.getTime()-r.getTime(),e.deadLineDiffDays=Math.ceil(t/864e5));a=new Date(e.paymentDate).getTime()-r.getTime();e.payDiffDays=Math.ceil(a/864e5)}),$("#myRenewContracList").DataTable({...commonSettingsProvision,layout:{topStart:function(){var e=document.createElement("div");return e.innerHTML='<h6 class="fw-bold"><i class="fa-solid fa-circle-exclamation mx-1"></i>若要續用，請於到期前申請續約。</h6>',e}},data:dataset_myCultivationRoom,columns:[{data:"startDate",title:"進駐開始"},{data:"endDate",title:"進駐結束"},{data:"building",title:"所在區域"},{data:"room",title:"室"},{data:"thisTimeDeadline",title:"本階段<br>到期日"},{data:"nextTimeDeadline",title:"下階段<br>到期日"},{data:"paymentDate",title:"已通知<br>付款日"},{data:"remark",title:"備註"},{data:"id",title:"通知<br>匯款",render:function(e,t,a){var i=a.endDiffDays,a=a.paymentDate;return i<0?"":a?'<button type="button" class="btn btn-light rounded-circle remittance_voucher align_center reuploadRemittance" title="再次上傳匯款憑證" data-id="'+e+'"><i class="fa-solid fa-money-check-dollar"></i></button>':'<button type="button" class="btn btn-outline-primary rounded-circle remittance_voucher align_center uploadRemittance" title="上傳匯款憑證" data-bs-toggle="modal" data-bs-target="#remittanceModal" data-id="'+e+'"><i class="fa-solid fa-money-check-dollar"></i></button>'},className:"text-center text-nowrap"},{data:"id",title:"續約",render:function(e,t,a){a=a.endDiffDays;return a<0?"":a<50?'<a class="btn btn-outline-primary rounded-circle btn-sm oneWord" href="./renewContractApply.html?id='+e+'" title="立即續約"><i class="fa-solid fa-repeat"></i></a>':'<button type="button" class="btn btn-light rounded-circle btn-sm" title="續約時間未到"><i class="fa-solid fa-hourglass-half"></i></button>'}},{data:"id",visible:!1,render:function(e,t,a){var{endDate:a,thisTimeDeadline:i,nextTimeDeadline:n}=a;return new Date(a)<r?"9999-99-99":n&&""!==n?n:i}}],order:[[10,"asc"]],columnDefs:[{targets:[2],responsivePriority:1},{targets:[3],responsivePriority:2},{targets:[8],responsivePriority:3},{searchable:!1,orderable:!1,targets:[8,9]},{className:"text-center",targets:[0,1,3,4,5,6,8]},{className:"text-nowrap",targets:[0,1,3,4,5,6,8]}],createdRow:function(t,e,a){$("td:eq(8)",t).css("max-width","70px"),[0,1,4,5,6].forEach(function(e){$("td:eq("+e+")",t).css("font-size",".9em")})}}),$(".uploadRemittance, .reuploadRemittance").click(function(e){clearValues(["danger_paymentDate","danger_paymentAmount","danger_last5AccountNo","paymentDate","paymentAmount","last5AccountNo","last5AccountNo","remittancePdf"]);var t,a=session_userData,a=($("#company").val(a.company),$(this));let i=a.data("id");i?(t=dataset_myCultivationRoom.find(e=>e.id==i))?($("#dataId").val(t.id),$("#type").val("培育室"),$("#renewOrReprint").val("階段費用"),$("#itemNum").val(t.building+"-"+t.room),a.hasClass("reuploadRemittance")&&(e.preventDefault(),swalConfirm("曾填過匯款通知，要再填一次嗎?","對，我要重新填寫上傳。","不，回到上一步。",function(){$("#remittanceModal").modal("show")}))):console.error("cultivationRoom data not found for id:",i):console.error("cultivationRoom ID not found in URL")}),$(".thisRequired").on("input change",function(){checkThisRequiredElements.call(this)}),$("#remittanceSubmit").click(function(e){var t;checkRequiredElements()?checkDangerElements()?(console.log("表單資料已送出"),t=$("#formRemittance").serializeArray(),console.log("表單資料：",JSON.stringify(t,null,2))):swalToastWarning("請填上正確資料唷！","top"):swalToastWarning("請將必填欄位填上正確資料唷！","top")})});