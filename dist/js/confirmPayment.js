var parkingSpaceCarData=["B1-01","B1-02","B2-03","B3-04","B2-05","B2-07","B3-11"],parkingSpaceMotoData=["B1-21","B1-22","B2-23","B3-24","B2-25","B2-26","B3-27"],idCardData=["N000030","N000051","N000040","N000089","N000012","N000060","N000070"],selectOptionStatus2=[{option:"使用中"},{option:"作廢收回"},{option:"刪除"}],selectOptionStatus=[{option:"待確認"},{option:"完成"},{option:"取消"},{option:"刪除"}],selectOption=[{option:"1"},{option:"2"},{option:"3"},{option:"4"}];$(function(){$("#confirmPaymentReceiptList").DataTable({...commonSettingsTable,data:dataset_confirmPaymentReceipt,columns:[{data:"createDate",title:"建立日期"},{data:"receiptNum",title:"收據號碼"},{data:"receiptDate",title:"收據日期",className:"text-center"},{data:"item",title:"收據項目"},{data:"amount",title:"收據<br class='d-none d-lg-block'>總額"},{data:"company",title:"收據抬頭"},{data:"uniformNum",title:"收據統編"},{data:"adminNote",title:"管理備註"},{data:"id",title:"操作",render:function(e,t,a){a=a.status;return"使用中"==!a||"作廢收回"==a?'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#confirmPaymentReceiptModel" data-id="'+e+'"><i class="fa-solid fa-wrench"></i>':'<button type="button" class="btn btn-info rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#confirmPaymentReceiptModel" data-id="'+e+'" title="登記收據資訊"><i class="fa-solid fa-wrench"></i>'},className:"text-nowrap"},{data:"status",visible:!1}],order:[[1,"desc"]],columnDefs:[{targets:[1],responsivePriority:1},{targets:[2],responsivePriority:2},{targets:[3],responsivePriority:3},{searchable:!1,orderable:!1,targets:[8]},{className:"text-lg-center",targets:[0,2,6,8]},{className:"text-nowrap",targets:[0,1,2,4,6,8]}],createdRow:function(t,e,a){$("td:eq(8)",t).css("min-width","70px"),[0,2].forEach(function(e){$("td:eq("+e+")",t).css("min-width","130px")}),[0,2,5,6].forEach(function(e){$("td:eq("+e+")",t).css("font-size",".9em")})}}),$("#confirmPaymentAllList").DataTable({...commonSettingsTable,data:dataset_confirmPaymentAll,columns:[{data:"createDate",title:"通知日期"},{data:"company",title:"通知公司"},{data:"paymentDate",title:"付款日",className:"text-center"},{data:"amount",title:"付款金額"},{data:"adminNote",title:"管理備註"},{data:"id",title:"操作",render:function(e,t,a){a=a.status;return"完成"==a||"取消"==a?'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#confirmPaymentModel" data-id="'+e+'"><i class="fa-solid fa-info px-1"></i>':'<button type="button" class="btn btn-info rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#confirmPaymentModel" data-id="'+e+'" title="登記收據資訊"><i class="fa-solid fa-info px-1"></i>'}},{data:"status",visible:!1}],order:[[6,"desc"],[0,"desc"],[2,"desc"]],columnDefs:[{targets:[1],responsivePriority:1},{targets:[2],responsivePriority:2},{targets:[3],responsivePriority:3},{searchable:!1,orderable:!1,targets:[5]},{className:"text-lg-center",targets:[0,2,5]},{className:"text-nowrap",targets:[0,2,5]}],createdRow:function(t,e,a){$("td:eq(5)",t).css("min-width","70px"),$("td:eq(1)",t).css("min-width","150px"),[0,2,3,4].forEach(function(e){$("td:eq("+e+")",t).css("font-size",".9em")})}}),$("#confirmPaymentCultivationRoomList").DataTable({...commonSettingsTable,data:dataset_confirmPaymentCultivationRoom,columns:[{data:"building",title:"大樓"},{data:"room",title:"室"},{data:"defaultAmount",title:"預設<br class='d-none d-lg-block'>費用"},{title:"配置公司",data:function(e){return e.now.company||"-"}},{title:"階段&#10102;",data:function(e){var t=new Date,a=new Date(e.now.deadline1);return e.now.receivedDate1?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate1+"</span>":e.now.deadline1?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline1+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline1+"</span>":"-"}},{title:"階段&#10103;",data:function(e){var t=new Date,a=new Date(e.now.deadline2);return e.now.receivedDate2?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate2+"</span>":e.now.deadline2?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline2+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline2+"</span>":"-"}},{title:"階段&#10104;",data:function(e){var t=new Date,a=new Date(e.now.deadline3);return e.now.receivedDate3?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate3+"</span>":e.now.deadline3?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline3+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline3+"</span>":"-"}},{title:"階段&#10105;",data:function(e){var t=new Date,a=new Date(e.now.deadline4);return e.now.receivedDate4?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate4+"</span>":e.now.deadline4?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline4+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline4+"</span>":"-"}},{title:"操作",data:function(e){return e.now.id?'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#confirmPaymentCultivationModel" data-id="now_'+e.roomId+'" title="修改"><i class="fa-solid fa-wrench"></i></button>':'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm wide_icon" data-bs-toggle="modal" data-bs-target="#confirmPaymentCultivationModel" data-id="def_'+e.roomId+'" title="配置進駐廠商"><i class="fa-regular fa-keyboard"></i></button>'}},{title:"下期",data:function(e){return e.now.id?'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm wide_icon" data-bs-toggle="modal" data-bs-target="#confirmPaymentCultivationModel" data-id="next_'+e.roomId+'" title="配置下期進駐廠商"><i class="fa-regular fa-keyboard"></i></button>':""}},{data:"recentMaturityDate",visible:!1}],order:[[10,"asc"],[0,"desc"]],columnDefs:[{targets:[0],responsivePriority:1},{targets:[1],responsivePriority:2},{targets:[3],responsivePriority:3},{searchable:!1,orderable:!1,targets:[8,9,10]},{className:"text-lg-center",targets:[1,4,5,6,7,8,9]},{className:"text-nowrap",targets:[0,1,2,4,5,6,7,8,9]}],createdRow:function(t,e,a){[8,9].forEach(function(e){$("td:eq("+e+")",t).css("max-width","70px")}),[0,1,2,3,4,5,6,7].forEach(function(e){$("td:eq("+e+")",t).css("font-size",".9em")})}}),$("#confirmPaymentParkingSpaceList").DataTable({...commonSettingsTable,data:dataset_confirmPaymentParkingSpace,columns:[{data:"building",title:"大樓"},{data:"parkingSpaceNum",title:"車位<br class='d-none d-lg-block'>號碼"},{data:"defaultAmount",title:"費用"},{title:"承租公司",data:function(e){return e.now.company||"-"}},{title:"階段&#10102;",data:function(e){var t=new Date,a=new Date(e.now.deadline1);return e.now.receivedDate1?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate1+"</span>":e.now.deadline1?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline1+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline1+"</span>":"-"}},{title:"階段&#10103;",data:function(e){var t=new Date,a=new Date(e.now.deadline2);return e.now.receivedDate2?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate2+"</span>":e.now.deadline2?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline2+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline2+"</span>":"-"}},{title:"階段&#10104;",data:function(e){var t=new Date,a=new Date(e.now.deadline3);return e.now.receivedDate3?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate3+"</span>":e.now.deadline3?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline3+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline3+"</span>":"-"}},{title:"階段&#10105;",data:function(e){var t=new Date,a=new Date(e.now.deadline4);return e.now.receivedDate4?'<span><i class="fa-solid fa-sack-dollar"></i> '+e.now.receivedDate4+"</span>":e.now.deadline4?a<t?'<span class="text-danger"><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline4+"</span>":'<span><i class="fa-regular fa-calendar-days"></i> '+e.now.deadline4+"</span>":"-"}},{title:"操作",data:function(e){return e.now.id?'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm" data-bs-toggle="modal" data-bs-target="#confirmPaymentParkingSpaceModel" data-id="now_'+e.parkingSpaceId+'" title="修改"><i class="fa-solid fa-wrench"></i></button>':'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm wide_icon" data-bs-toggle="modal" data-bs-target="#confirmPaymentParkingSpaceModel" data-id="def_'+e.parkingSpaceId+'" title="配置進駐廠商"><i class="fa-regular fa-keyboard"></i></button>'}},{title:"下期",data:function(e){return e.now.id?'<button type="button" class="btn btn-outline-primary rounded-circle btn-sm wide_icon" data-bs-toggle="modal" data-bs-target="#confirmPaymentParkingSpaceModel" data-id="next_'+e.parkingSpaceId+'" title="配置下期進駐廠商"><i class="fa-regular fa-keyboard"></i></button>':""}},{data:"recentMaturityDate",visible:!1}],order:[[10,"asc"],[0,"desc"]],columnDefs:[{targets:[0],responsivePriority:1},{targets:[1],responsivePriority:2},{targets:[2],responsivePriority:3},{searchable:!1,orderable:!1,targets:[8,9,10]},{className:"text-lg-center",targets:[0,4,5,6,7,8,9]},{className:"text-center",targets:[0,1]},{className:"text-nowrap",targets:[0,1,2,4,5,6,7,8,9]},{className:"p-1",targets:[4,5,6,7]}],createdRow:function(t,e,a){[8,9].forEach(function(e){$("td:eq("+e+")",t).css("max-width","70px")}),[0,1,2,4,5,6,7].forEach(function(e){$("td:eq("+e+")",t).css("font-size",".9em")}),$("td:eq(3)",t).css("min-width","150px")}})}),$(function(){$("#receiptCreateSubmit").click(function(e){e.preventDefault(),checkRequiredElements()&&(checkDangerElements()?($("#formReceiptCreate").submit(),swalToastSuccess("收據新增成功，請靜待畫面更新！","top"),setTimeout(function(){location.reload()},2300)):swalToastWarning("請填上正確資料唷！","top"))}),$("#confirmPaymentReceiptModel").on("show.bs.modal",function(e){e=$(e.relatedTarget);let t=String(e.data("id"));$("#receipt_updateBtn").off("click"),$("#danger_receiptBox").text("");e=dataset_confirmPaymentReceipt.find(e=>e.id===t);e?($("#receipt_receiptNum").text(e.receiptNum),$("#receipt_receiptDate").text(e.receiptDate),$("#receipt_receiptItem").text(e.item),$("#receipt_receiptAmount").text(e.amount),$("#receipt_companyName").text(e.company),$("#receipt_uniformNum").text(e.uniformNum),$("#receipt_status").text(e.status),$("#receipt_adminNote").text(e.adminNote),$("#receipt_createDate").text(e.createDate),$("#receipt_createBy").text(e.createBy)):console.error("資料找不到ID：",t),"使用中"===e.status?($("#receipt_receiptNum").addClass("changeInputUpperNumber_items"),$("#receipt_receiptDate").addClass("changeDate_items"),$("#receipt_receiptItem, #receipt_companyName, #receipt_adminNote").addClass("changeInput_items"),$("#receipt_receiptAmount").addClass("changeMoney_items"),$("#receipt_uniformNum").addClass("changeUniformNum_items"),$("#receipt_receiptNum, #receipt_receiptDate, #receipt_receiptItem, #receipt_companyName, #receipt_adminNote, #receipt_receiptAmount, #receipt_uniformNum").removeClass("readOnly"),$("#receipt_status").addClass("changeSelectStatus2_items"),CustomInputHandlers.init(),$("#receipt_updateBtn").show()):(CustomInputHandlers.destroy(),$("#receipt_receiptNum").removeClass("changeInputUpperNumber_items"),$("#receipt_receiptDate").removeClass("changeDate_items"),$("#receipt_receiptItem, #receipt_companyName, #receipt_adminNote").removeClass("changeInput_items"),$("#receipt_receiptAmount").removeClass("changeMoney_items"),$("#receipt_uniformNum").removeClass("changeUniformNum_items"),$("#receipt_receiptNum, #receipt_receiptDate, #receipt_receiptItem, #receipt_companyName, #receipt_adminNote, #receipt_receiptAmount, #receipt_uniformNum").addClass("readOnly"),$("#receipt_status").removeClass("changeSelectStatus2_items"),$("#receipt_updateBtn").hide()),$("#receipt_updateBtn").on("click",function(){var e={id:t,receiptNum:$("#receipt_receiptNum").text(),receiptDate:$("#receipt_receiptDate").text(),receiptItem:$("#receipt_receiptItem").text(),amount:$("#receipt_receiptAmount").text(),companyName:$("#receipt_companyName").text(),uniformNum:$("#receipt_uniformNum").text(),status:$("#receipt_status").text(),adminNote:$("#receipt_adminNote").text()};e.receiptNum&&e.receiptDate&&e.receiptItem&&e.amount&&e.companyName&&e.uniformNum?($("#danger_receiptBox").text(""),$.ajax({url:receiptEditUrl,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){swalToastSuccess(e.message,"top"),setTimeout(function(){location.reload()},2300)},error:function(e,t,a){console.error("Error:",a),swalToastWarning("儲存修改時發生錯誤，請稍後再試。","top")}})):$("#danger_receiptBox").text("請留下完整的資料，才可以儲存修改歐！")})}),$("#confirmPaymentModel").on("show.bs.modal",function(e){e=$(e.relatedTarget);let t=String(e.data("id"));$("#payment_updateBtn").off("click"),$("#danger_paymentBox").text(""),$("#payment_items").html("");var a,e=dataset_confirmPaymentAll.find(e=>e.id===t);e?($("#payment_companyName").text(e.company),$("#payment_uniformNum").text(e.uniformNum),"-"!=e.remittanceFile?(a=e.remittanceFile.length,"1"!=e.remittanceFile.substring(a-5,a-4)?$("#payment_downloadRemittanceFile").html(`<a class="d-inline me-3 text-nowrap" href="/download_T/T_${e.id}">下載&ensp;<i class="fa-solid fa-download"></i><span class="mx-1 update">補</span></a>`):$("#payment_downloadRemittanceFile").html(`<a class="d-inline me-3 text-nowrap" href="/download_T/T_${e.id}">下載&ensp;<i class="fa-solid fa-download"></i>`)):$("#payment_downloadRemittanceFile").text("-").addClass("readOnly"),$("#payment_companyEmail").text(e.companyEmail),$("#payment_contactPerson").text(e.contactPerson),$("#payment_companyPhone").text(e.companyPhone),$("#payment_paymentDate").text(e.paymentDate),$("#payment_paymentAmount").text(e.amount),$("#payment_last5AccountNo").text(e.last5AccountNo),e.items.forEach(function(e){e=`
                <li>
                    <span class="text-nowrap text-secondary">${e.type}</span>
                    <span class="text-nowrap">${e.description}</span>
                    <span class="text-nowrap text-danger">${e.amount}</span>
                </li>`;$("#payment_items").append(e)}),$("#gotoEditRemittance").attr("href","/Remittance/Edit/"+e.id),$("#payment_adminNote").text(e.adminNote),$("#payment_status").text(e.status)):console.error("paymentData not found for id:",t),"完成"===e.status||"取消"===e.status?(CustomInputHandlers.destroy(),$("#payment_adminNote").removeClass("changeInput_items"),$("#payment_status").removeClass("changeSelectStatus_items"),$("#payment_adminNote, #payment_status").addClass("readOnly"),$("#payment_updateBtn, #gotoEditRemittance").hide()):($("#payment_adminNote").addClass("changeInput_items"),$("#payment_status").addClass("changeSelectStatus_items"),$("#payment_adminNote, #payment_status").removeClass("readOnly"),CustomInputHandlers.init(),$("#payment_updateBtn, #gotoEditRemittance").show()),$("#payment_updateBtn").on("click",function(){var e={};e.id=t,e.adminNote=$("#payment_adminNote").text(),e.status=$("#payment_status").text(),$.ajax({url:paymentStatusEditUrl,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){swalToastSuccess(e.message,"top"),setTimeout(function(){$("#confirmPaymentModel").modal("hide"),location.reload()},2300)},error:function(e,t,a){swalToastError("提交失敗，請稍後再試。","top")}})})}),$("#confirmPaymentCultivationModel").on("show.bs.modal",function(e){e=$(e.relatedTarget);let a=String(e.data("id")),n="";switch(a.substring(0,4)){case"now_":case"def_":n=a.substring(4);break;default:n=a.substring(5)}let i=dataset_confirmPaymentCultivationRoom.find(e=>e.roomId==n),o=["#cultivation_receiptNum1","#cultivation_receiptNum2","#cultivation_receiptNum3","#cultivation_receiptNum4"],s=["#cultivation_deadline1","#cultivation_deadline2","#cultivation_deadline3","#cultivation_deadline4"],c=["#cultivation_label_receiptNum1","#cultivation_label_receiptNum2","#cultivation_label_receiptNum3","#cultivation_label_receiptNum4"],d=["#cultivation_label_deadline1","#cultivation_label_deadline2","#cultivation_label_deadline3","#cultivation_label_deadline4"],p=["#cultivation_label_installmentAmount1","#cultivation_label_installmentAmount2","#cultivation_label_installmentAmount3","#cultivation_label_installmentAmount4"],m=["#cultivation_installmentAmount1","#cultivation_installmentAmount2","#cultivation_installmentAmount3","#cultivation_installmentAmount4"],u="pinkBG",_="grayBG";if($("#cultivation_adminNote").addClass("changeInput_items"),$("#cultivation_startDate, #cultivation_endDate").addClass("changeDate_items"),$("#cultivation_uniformNum").addClass("changeUniformNum_items"),$("#cultivation_squareMeters").addClass("changeDecimal_items"),i){$("#cultivation_building").text(i.building),$("#cultivation_room").text(i.room);let l=null;var t,e=a.startsWith("now_"),r=a.startsWith("next_"),g=(e?l=i.now:r&&(l=i.next),l&&l.id?$("#cultivation_deleteData, #cultivation_reminder").removeClass("d-none"):$("#cultivation_deleteData, #cultivation_reminder").addClass("d-none"),$("#cultivation_inputRate").val(l?.amount||i.defaultAmount),$("#cultivation_squareMeters").text(l?.squareMeters||i.defaultSquareMeters),$("#cultivation_startDate").text(l?.startDate||formatDate(new Date((new Date).setDate((new Date).getDate()+1)))),$("#cultivation_endDate").text(l?.endDate||formatDate(new Date((new Date).setFullYear((new Date).getFullYear()+1)))),l?.period||"1"),f=($("#cultivation_selectPeriod").val(g),$("#cultivation_companyName").text(l?.company||""),$("#cultivation_uniformNum").text(l?.uniformNum||""),$("#cultivation_responsiblePerson").text(l?.responsiblePerson||""),$("#cultivation_companyEmail").text(l?.companyEmail||""),$("#cultivation_contactPerson").text(l?.contactPerson||""),$("#cultivation_companyPhone").text(l?.companyPhone||""),$("#cultivation_deadline1").text(l?.deadline1||""),$("#cultivation_deadline2").text(l?.deadline2||""),$("#cultivation_deadline3").text(l?.deadline3||""),$("#cultivation_deadline4").text(l?.deadline4||""),parseFloat($("#cultivation_rate").text().replace(/,/g,"")));if(l)for(let e=1;e<=4;e++)l["receivableAmount"+e]?$("#cultivation_installmentAmount"+e).text(l["receivableAmount"+e]):g>=e&&(t=(12*f/g).toLocaleString(),$("#cultivation_installmentAmount"+e).text(t)),$("#cultivation_receiptNum"+e).text(l["receiptNum"+e]||""),$("#cultivation_receivedDate"+e).text(l["receivedDate"+e]||"");function v(){CustomInputHandlers.destroy();var e=$("#cultivation_selectPeriod").val(),t=parseFloat($("#cultivation_inputRate").val().replace(/,/g,""));if(isNaN(e)||isNaN(t))console.log("Invalid values for period or rate.");else{c.forEach((e,t)=>{$(e).removeClass(u).removeClass(_),$(p[t]).removeClass(u).removeClass(_),$(d[t]).removeClass(u).removeClass(_),$(o[t]).removeClass("changeInput_items"),$(m[t]).removeClass("changeMoney_items"),$(s[t]).removeClass("changeDate_items")});{var r=e;let n=12*t,i=0,o=r;m.forEach((e,t)=>{let a=null;l&&l["receivableAmount"+(t+1)]&&(a=parseFloat(l["receivableAmount"+(t+1)].replace(/,/g,""))),!isNaN(a)&&t<r&&null!=a?(null!=a?$(e).text(a.toLocaleString()):$(e).text(""),i+=a,o--):t<r?(t=n-i,t=0<o?t/o:0,$(e).text(t.toLocaleString())):$(e).text("")})}var a=e;for(let e=0;e<a;e++)$(c[e]).addClass(u),$(p[e]).addClass(u),$(d[e]).addClass(u),$(o[e]).addClass("changeInput_items"),$(m[e]).addClass("changeMoney_items"),$(s[e]).addClass("changeDate_items");CustomInputHandlers.init()}}$("#cultivation_adminNote").text(l?.adminNote||""),v(),$("#cultivation_inputRate").on("input",function(){$(this).val().trim();v()}),$("#cultivation_selectPeriod").on("change",function(){$(this).val();v()})}$("#cultivation_updateBtn").off("click"),$("#cultivation_deleteData").off("click"),$("#cultivation_deleteData").on("click",function(){let e="";switch(a.substring(0,4)){case"now_":e=i.now.id;break;case"next":e=i.next.id;break;default:e="add"}$.ajax({url:deleteRoomRecordsUrl,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){swalToastSuccess(e.message,"top"),setTimeout(function(){location.reload()},2300)},error:function(e,t,a){swalToastWarning("刪除配置紀錄時發生錯誤。","top")}})}),$("#cultivation_updateBtn").on("click",function(){let e="";switch(a.substring(0,4)){case"now_":e=i.now.id;break;case"next_":e=i.next.id;break;default:e="add"}var t={roomId:n,id:e,squareMeters:$("#cultivation_squareMeters").text(),amount:$("#cultivation_inputRate").val(),startDate:$("#cultivation_startDate").text(),endDate:$("#cultivation_endDate").text(),period:$("#cultivation_selectPeriod").val(),uniformNum:$("#cultivation_uniformNum").text(),deadline1:$("#cultivation_deadline1").text(),deadline2:$("#cultivation_deadline2").text(),deadline3:$("#cultivation_deadline3").text(),deadline4:$("#cultivation_deadline4").text(),receivableAmount1:$("#cultivation_installmentAmount1").text(),receivableAmount2:$("#cultivation_installmentAmount2").text(),receivableAmount3:$("#cultivation_installmentAmount3").text(),receivableAmount4:$("#cultivation_installmentAmount4").text(),receiptNum1:$("#cultivation_receiptNum1").text(),receiptNum2:$("#cultivation_receiptNum2").text(),receiptNum3:$("#cultivation_receiptNum3").text(),receiptNum4:$("#cultivation_receiptNum4").text(),adminNote:$("#cultivation_adminNote").text()};t.startDate&&t.endDate&&t.period&&t.uniformNum&&t.deadline1&&t.receivableAmount1&&t.amount?($("#danger_roomBox").text(""),$.ajax({url:editRoomRecordsUrl,type:"POST",contentType:"application/json",data:JSON.stringify(t),success:function(e){swalToastSuccess(e.message,"top"),setTimeout(function(){location.reload()},2300)},error:function(e,t,a){swalToastWarning("刪除配置紀錄時發生錯誤。","top")}})):$("#danger_roomBox").text("請留下完整的資料，才可以儲存修改歐！")})}),$("#confirmPaymentParkingSpaceModel").on("show.bs.modal",function(e){e=$(e.relatedTarget);let a=String(e.data("id")),n="";switch(a.substring(0,4)){case"now_":case"def_":n=a.substring(4);break;default:n=a.substring(5)}let t=dataset_confirmPaymentParkingSpace.find(e=>e.parkingSpaceId==n),i=["#parkingSpace_receiptNum1","#parkingSpace_receiptNum2","#parkingSpace_receiptNum3","#parkingSpace_receiptNum4"],o=["#parkingSpace_deadline1","#parkingSpace_deadline2","#parkingSpace_deadline3","#parkingSpace_deadline4"],s=["#parkingSpace_installmentAmount1","#parkingSpace_installmentAmount2","#parkingSpace_installmentAmount3","#parkingSpace_installmentAmount4"],c=["#parkingSpace_label_receiptNum1","#parkingSpace_label_receiptNum2","#parkingSpace_label_receiptNum3","#parkingSpace_label_receiptNum4"],d=["#parkingSpace_label_deadline1","#parkingSpace_label_deadline2","#parkingSpace_label_deadline3","#parkingSpace_label_deadline4"],p=["#parkingSpace_label_installmentAmount1","#parkingSpace_label_installmentAmount2","#parkingSpace_label_installmentAmount3","#parkingSpace_label_installmentAmount4"],m="pinkBG",u="grayBG";if($("#parkingSpace_adminNote").addClass("changeInput_items"),$("#parkingSpace_startDate, #parkingSpace_endDate").addClass("changeDate_items"),$("#parkingSpace_licensePlateNum").addClass("changeUpper_items"),t){$("#parkingSpace_building").text(t.building),$("#parkingSpace_parkingSpaceNum").text(t.parkingSpaceNum),$("#parkingSpace_carType").text(t.carType);let l=null;var r,e=a.startsWith("now_"),_=a.startsWith("next_"),g=(e?l=t.now:_&&(l=t.next),l&&l.id?$("#parkingSpace_deleteData, #parkingSpace_reminder").removeClass("d-none"):$("#parkingSpace_deleteData, #parkingSpace_reminder").addClass("d-none"),$("#parkingSpace_inputRate").val(l?.amount||t.defaultAmount),$("#parkingSpace_licensePlateNum").text(l?.licensePlateNum||""),$("#parkingSpace_startDate").text(l?.startDate||formatDate(new Date((new Date).setDate((new Date).getDate()+1)))),$("#parkingSpace_endDate").text(l?.endDate||formatDate(new Date((new Date).setFullYear((new Date).getFullYear()+1)))),l?.period||"1"),f=($("#parkingSpace_selectPeriod").val(g),$("#parkingSpace_companyName").text(l?.company||""),$("#parkingSpace_uniformNum").text(l?.uniformNum||""),$("#parkingSpace_applicant").text(l?.applicant||""),$("#parkingSpace_email").text(l?.email||""),$("#parkingSpace_phone").text(l?.phone||""),$("#parkingSpace_deadline1").text(l?.deadline1||""),$("#parkingSpace_deadline2").text(l?.deadline2||""),$("#parkingSpace_deadline3").text(l?.deadline3||""),$("#parkingSpace_deadline4").text(l?.deadline4||""),parseFloat($("#parkingSpace_rate").text().replace(/,/g,"")));if(l)for(let e=1;e<=4;e++)l["receivableAmount"+e]?$("#parkingSpace_installmentAmount"+e).text(l["receivableAmount"+e]):g>=e&&(r=(12*f/g).toLocaleString(),$("#parkingSpace_installmentAmount"+e).text(r)),$("#parkingSpace_receiptNum"+e).text(l["receiptNum"+e]||""),$("#parkingSpace_receivedDate"+e).text(l["receivedDate"+e]||"");function v(){CustomInputHandlers.destroy();var e=$("#parkingSpace_selectPeriod").val(),t=parseFloat($("#parkingSpace_inputRate").val().replace(/,/g,""));if(isNaN(e)||isNaN(t))console.log("Invalid values for period or rate.");else{c.forEach((e,t)=>{$(e).removeClass(m).removeClass(u),$(p[t]).removeClass(m).removeClass(u),$(d[t]).removeClass(m).removeClass(u),$(i[t]).removeClass("changeInput_items"),$(s[t]).removeClass("changeMoney_items"),$(o[t]).removeClass("changeDate_items")});{var r=e;let n=12*t,i=0,o=r;s.forEach((e,t)=>{let a=null;l&&l["receivableAmount"+(t+1)]&&(a=parseFloat(l["receivableAmount"+(t+1)].replace(/,/g,""))),!isNaN(a)&&t<r&&null!=a?(null!=a?$(e).text(a.toLocaleString()):$(e).text(""),i+=a,o--):t<r?(t=n-i,t=0<o?t/o:0,$(e).text(t.toLocaleString())):$(e).text("")})}var a=e;for(let e=0;e<a;e++)$(c[e]).addClass(m),$(p[e]).addClass(m),$(d[e]).addClass(m),$(i[e]).addClass("changeInput_items"),$(s[e]).addClass("changeMoney_items"),$(o[e]).addClass("changeDate_items");CustomInputHandlers.init()}}$("#parkingSpace_adminNote").text(l?.adminNote||""),v(),$("#parkingSpace_inputRate").on("input",function(){$(this).val().trim();v()}),$("#parkingSpace_selectPeriod").on("change",function(){$(this).val();v()})}$("#parkingSpace_updateBtn").off("click"),$("#parkingSpace_deleteData").off("click"),$("#parkingSpace_deleteData").on("click",function(){console.log("使用Id",a);let e="";switch(a.substring(0,4)){case"now_":e=t.now.id;break;case"next":e=t.next.id;break;default:e="add"}console.log("刪除Id",e),$.ajax({url:deletePSRecordsUrl,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){swalToastSuccess(e.message,"top"),setTimeout(function(){location.reload()},2300)},error:function(e,t,a){swalToastWarning("刪除配置紀錄時發生錯誤。","top")}})}),$("#parkingSpace_updateBtn").on("click",function(){console.log("PSId Btn :",a);let e="";switch(a.substring(0,4)){case"now_":e=roomData.now.id;break;case"next_":e=roomData.next.id;break;default:e="add"}var t={parkingSpaceId:n,id:e,amount:$("#parkingSpace_inputRate").val(),startDate:$("#parkingSpace_startDate").text(),endDate:$("#parkingSpace_endDate").text(),period:$("#parkingSpace_selectPeriod").val(),licensePlateNum:$("#parkingSpace_licensePlateNum").text(),deadline1:$("#parkingSpace_deadline1").text(),deadline2:$("#parkingSpace_deadline2").text(),deadline3:$("#parkingSpace_deadline3").text(),deadline4:$("#parkingSpace_deadline4").text(),receivableAmount1:$("#parkingSpace_installmentAmount1").text(),receivableAmount2:$("#parkingSpace_installmentAmount2").text(),receivableAmount3:$("#parkingSpace_installmentAmount3").text(),receivableAmount4:$("#parkingSpace_installmentAmount4").text(),receiptNum1:$("#parkingSpace_receiptNum1").text(),receiptNum2:$("#parkingSpace_receiptNum2").text(),receiptNum3:$("#parkingSpace_receiptNum3").text(),receiptNum4:$("#parkingSpace_receiptNum4").text(),adminNote:$("#parkingSpace_adminNote").text()};console.log("psUpdatedData:",t),t.startDate&&t.endDate&&t.period&&t.licensePlateNum&&t.deadline1&&t.receivableAmount1&&t.amount?($("#danger_parkingSapceBox").text(""),$.ajax({url:editPSRecordsUrl,type:"POST",contentType:"application/json",data:JSON.stringify(t),success:function(e){console.log("更新成功:",e),swalToastSuccess(e.message,"top"),setTimeout(function(){location.reload()},2300)},error:function(e,t,a){console.error("更新失敗:",a),swalToastWarning("刪除配置紀錄時發生錯誤。","top")}})):$("#danger_parkingSapceBox").text("請留下完整的資料，才可以儲存修改歐！")})})}),$(function(){var a=$("#confirmPaymentReceiptList").DataTable(),n=$("#confirmPaymentAllList").DataTable(),i=$("#confirmPaymentCultivationRoomList").DataTable(),o=$("#confirmPaymentParkingSpaceList").DataTable();$('button[data-bs-toggle="pill"]').on("shown.bs.tab",function(e){var t;switch($(e.target).data("bs-target")){case'#pills-one"':t=a;break;case"#pills-two":t=n;break;case"#pills-three":t=i;break;case"#pills-four":t=o}t&&setTimeout(function(){t.columns.adjust().responsive.recalc()},30)})}),$(function(){$("#typeahead_receiptCompanyAdd").typeahead({source:companyData})});